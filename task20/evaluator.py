"""AI-–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 20 —á–µ—Ä–µ–∑ YandexGPT."""

import logging
import os
import json
from enum import Enum
from typing import Dict, List, Any, Optional
from core.types import (
    UserID,
    TaskType,
    EvaluationResult,
    CallbackData,
    TaskRequirements,
)

logger = logging.getLogger(__name__)

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–º–ø–æ—Ä—Ç
try:
    from core.ai_evaluator import (
        BaseAIEvaluator,
    )
    from core.ai_service import YandexGPTService, YandexGPTConfig, YandexGPTModel
    AI_EVALUATOR_AVAILABLE = True
except ImportError as e:
    logger.warning(f"AI evaluator components not available: {e}")
    AI_EVALUATOR_AVAILABLE = False

    # –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ AI

    class BaseAIEvaluator:
        def __init__(self, requirements: TaskRequirements):
            self.requirements = requirements
    
    class YandexGPTService:
        pass
    
    class YandexGPTConfig:
        pass
    
    class YandexGPTModel:
        LITE = "yandexgpt-lite"
        PRO = "yandexgpt"


class StrictnessLevel(Enum):
    """–£—Ä–æ–≤–Ω–∏ —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏."""
    LENIENT = "–ú—è–≥–∫–∏–π"
    STANDARD = "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π" 
    STRICT = "–°—Ç—Ä–æ–≥–∏–π"
    EXPERT = "–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π"


class Task20AIEvaluator(BaseAIEvaluator if AI_EVALUATOR_AVAILABLE else object):
    """AI-–ø—Ä–æ–≤–µ—Ä—â–∏–∫ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 20 —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π —Å—Ç—Ä–æ–≥–æ—Å—Ç—å—é."""
    
    def __init__(self, strictness: StrictnessLevel = StrictnessLevel.STANDARD):
        self.strictness = strictness
        
        if AI_EVALUATOR_AVAILABLE:
            requirements = TaskRequirements(
                task_number=20,
                task_name="–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–∂–¥–µ–Ω–∏–π",
                max_score=3,
                criteria=[
                    {
                        "name": "–ö1",
                        "max_score": 3,
                        "description": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—É–∂–¥–µ–Ω–∏–π (–ø–æ 1 –±–∞–ª–ª—É –∑–∞ –∫–∞–∂–¥–æ–µ)"
                    }
                ],
                description="–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ç—Ä–∏ —Å—É–∂–¥–µ–Ω–∏—è..."
            )
            super().__init__(requirements)
        else:
            self.requirements = TaskRequirements(
                task_number=20,
                task_name="–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–∂–¥–µ–Ω–∏–π",
                max_score=3,
                criteria=[{"name": "–ö1", "max_score": 3, "description": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—É–∂–¥–µ–Ω–∏–π"}],
                description="–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ç—Ä–∏ —Å—É–∂–¥–µ–Ω–∏—è..."
            )
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
        self.ai_service = None
        if AI_EVALUATOR_AVAILABLE:
            try:
                config = YandexGPTConfig.from_env()
                # –í—ã–±–∏—Ä–∞–µ–º –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏
                if strictness in [StrictnessLevel.STRICT, StrictnessLevel.EXPERT]:
                    config.model = YandexGPTModel.PRO
                else:
                    config.model = YandexGPTModel.LITE
                
                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
                if strictness == StrictnessLevel.LENIENT:
                    config.temperature = 0.4
                elif strictness == StrictnessLevel.STANDARD:
                    config.temperature = 0.3
                else:
                    config.temperature = 0.2
                    
                self.config = config
                logger.info(f"Task20 AI evaluator configured with {strictness.value} strictness")
            except Exception as e:
                logger.error(f"Failed to configure AI service: {e}")
                self.config = None
    
    def get_system_prompt(self) -> str:
        """–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è YandexGPT."""
        base_prompt = """–¢—ã - –æ–ø—ã—Ç–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –ï–ì–≠ –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–¥–∞–Ω–∏—è 20.

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø –ó–ê–î–ê–ù–ò–Ø 20:
1. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∑–∞–¥–∞–Ω–∏—è 19, –∑–¥–µ—Å—å –ù–ï –Ω—É–∂–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
2. –¢—Ä–µ–±—É—é—Ç—Å—è —Å—É–∂–¥–µ–Ω–∏—è –ê–ë–°–¢–†–ê–ö–¢–ù–û–ì–û —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –æ–±–æ–±—â–µ–Ω–∏—è
3. –°—É–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ–≥–æ –æ–±—ä—ë–º–∞ –∏ –º–µ–Ω–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
4. –ö–∞–∂–¥–æ–µ —Å—É–∂–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
5. –°—É–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –æ–±–æ–±—â–µ–Ω–∏—è

–ö–†–ò–¢–ï–†–ò–ò –û–¶–ï–ù–ò–í–ê–ù–ò–Ø:
- 3 –±–∞–ª–ª–∞: –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ —Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞
- 2 –±–∞–ª–ª–∞: –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –Ω–∞ –æ–¥–Ω–æ —Å—É–∂–¥–µ–Ω–∏–µ –º–µ–Ω—å—à–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ
- 1 –±–∞–ª–ª: –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –Ω–∞ –¥–≤–∞ —Å—É–∂–¥–µ–Ω–∏—è –º–µ–Ω—å—à–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ  
- 0 –±–∞–ª–ª–æ–≤: –ø—Ä–∏–≤–µ–¥–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç –ò–õ–ò —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞

–®–¢–†–ê–§–´:
- –ï—Å–ª–∏ –Ω–∞—Ä—è–¥—É —Å —Ç—Ä–µ–±—É–µ–º—ã–º–∏ —Å—É–∂–¥–µ–Ω–∏—è–º–∏ –µ—Å—Ç—å 2+ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å –æ—à–∏–±–∫–∞–º–∏ ‚Üí 0 –±–∞–ª–ª–æ–≤
- –ï—Å–ª–∏ –µ—Å—Ç—å 1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å –æ—à–∏–±–∫–æ–π ‚Üí –º–∏–Ω—É—Å 1 –±–∞–ª–ª –æ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ

–ß–¢–û –°–ß–ò–¢–ê–ï–¢–°–Ø –ü–†–ê–í–ò–õ–¨–ù–´–ú –°–£–ñ–î–ï–ù–ò–ï–ú –î–õ–Ø –ó–ê–î–ê–ù–ò–Ø 20:
- –°–æ–¥–µ—Ä–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –æ–±–æ–±—â–µ–Ω–∏—è (—Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç, –ø—Ä–∏–≤–æ–¥–∏—Ç –∫, –≤–ª–∏—è–µ—Ç –Ω–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, –ø–æ–∑–≤–æ–ª—è–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç, —Ä–∞–∑–≤–∏–≤–∞–µ—Ç, –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç, —Å–Ω–∏–∂–∞–µ—Ç, –ø–æ–≤—ã—à–∞–µ—Ç, —É–ª—É—á—à–∞–µ—Ç, —É—Ö—É–¥—à–∞–µ—Ç, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç)
- –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ (–¥–∞—Ç, –∏–º—ë–Ω, –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π/–∫–æ–º–ø–∞–Ω–∏–π)
- –Ø–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º (–Ω–µ –º–µ–Ω–µ–µ 5 —Å–ª–æ–≤)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –∑–∞–¥–∞–Ω–∏—è
- –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏

–ß–¢–û –ù–ï –ó–ê–°–ß–ò–¢–´–í–ê–ï–¢–°–Ø:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–í 2020 –≥–æ–¥—É –≤ –†–æ—Å—Å–∏–∏...", "–ö–æ–º–ø–∞–Ω–∏—è Apple...", "–í–æ –§—Ä–∞–Ω—Ü–∏–∏...")
- –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π, –¥–∞—Ç, —Å–æ–±—ã—Ç–∏–π
- –°–ª–∏—à–∫–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –±–µ–∑ –æ–±–æ–±—â–µ–Ω–∏—è
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è
- –û–±—â–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –±–µ–∑ —á—ë—Ç–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –°—É–∂–¥–µ–Ω–∏—è, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π –≤–º–µ—Å—Ç–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ)

–ü–†–ê–í–ò–õ–û –î–£–ë–õ–ò–†–£–Æ–©–ò–• –°–£–ñ–î–ï–ù–ò–ô:
–ï—Å–ª–∏ –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ —Å—É–∂–¥–µ–Ω–∏—è –ø–æ —Å—É—Ç–∏ –î–£–ë–õ–ò–†–£–Æ–¢ –∏–ª–∏ –î–û–ü–û–õ–ù–Ø–Æ–¢ –¥—Ä—É–≥ –¥—Ä—É–≥–∞
(—Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∞—Å–ø–µ–∫—Ç —Ç–µ–º—ã —Å —Ä–∞–∑–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω), –æ–Ω–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è
–∫–∞–∫ –û–î–ò–ù —ç–ª–µ–º–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∞, –∞ –Ω–µ –¥–≤–∞.

–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏:
1. –ü–æ—Å–ª–µ –æ—Ü–µ–Ω–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å—É–∂–¥–µ–Ω–∏—è –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏, —Å—Ä–∞–≤–Ω–∏ –í–°–ï –ø–∞—Ä—ã —Å—É–∂–¥–µ–Ω–∏–π
2. –ï—Å–ª–∏ –¥–≤–∞ —Å—É–∂–¥–µ–Ω–∏—è –æ–±—ä—è—Å–Ω—è—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —è–≤–ª–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –¥—É–±–ª—å
3. –ï—Å–ª–∏ –æ–¥–Ω–æ —Å—É–∂–¥–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç–Ω—ã–º —Å–ª—É—á–∞–µ–º –¥—Ä—É–≥–æ–≥–æ ‚Äî —ç—Ç–æ –¥—É–±–ª—å
4. –ó–∞—Å—á–∏—Ç–∞–π –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Å—É–∂–¥–µ–Ω–∏—è –∫–∞–∫ –û–î–ù–û

–ü—Ä–∏–º–µ—Ä –¥—É–±–ª—è:
- ¬´–ù–∞–ª–æ–≥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã¬ª –∏
  ¬´–ë–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞–ª–æ–≥–∞–º –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã–ø–ª–∞—Ç—É –ø–µ–Ω—Å–∏–π –∏ –ø–æ—Å–æ–±–∏–π¬ª
‚Üí –û–±–∞ —Å—É–∂–¥–µ–Ω–∏—è –æ–± –æ–¥–Ω–æ–º (—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä—ã) ‚Üí —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ 1 —ç–ª–µ–º–µ–Ω—Ç

–ü—Ä–∏–º–µ—Ä –ù–ï –¥—É–±–ª—è:
- ¬´–ù–∞–ª–æ–≥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã¬ª –∏
  ¬´–ù–∞–ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–µ–≥—É–ª–∏—Ä—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Å–¥–µ—Ä–∂–∏–≤–∞—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤—Ä–µ–¥–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤¬ª
‚Üí –†–∞–∑–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã (—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ vs —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) ‚Üí 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞

–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∂–∏, –µ—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥—É–±–ª–∏:
"–°—É–∂–¥–µ–Ω–∏—è [N] –∏ [M] –¥—É–±–ª–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ (–æ–±–∞ –æ [—Ç–µ–º–∞]) ‚Üí –∑–∞—Å—á–∏—Ç–∞–Ω—ã –∫–∞–∫ 1 —ç–ª–µ–º–µ–Ω—Ç"

–°–í–Ø–ó–¨ –° –¢–ï–ó–ò–°–û–ú ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê!

–°—É–∂–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –õ–û–ì–ò–ß–ï–°–ö–ò –°–í–Ø–ó–ê–ù–û —Å —Ç–µ–∑–∏—Å–æ–º, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å/–∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å.

‚ùå –ù–ï –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:
"–ù–∞–ª–æ–≥–∏ –≤–∞–∂–Ω—ã –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞"
‚Üí –≠—Ç–æ –∏—Å—Ç–∏–Ω–Ω–æ–µ —Å—É–∂–¥–µ–Ω–∏–µ, –Ω–æ –æ–Ω–æ –ù–ï —Å–≤—è–∑–∞–Ω–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ç–µ–∑–∏—Å–æ–º –∑–∞–¥–∞–Ω–∏—è

‚úÖ –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:
"–ß—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –º–æ—Ç–∏–≤–∞—Ü–∏—é –∫ —Ç—Ä—É–¥—É,
–ø–æ—Å–∫–æ–ª—å–∫—É —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∏—Ö –¥–æ—Ö–æ–¥–∞ –∏–∑—ã–º–∞–µ—Ç—Å—è"
‚Üí –°—É–∂–¥–µ–Ω–∏–µ –ø—Ä—è–º–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–∑–∏—Å–æ–º –æ —Ä–∏—Å–∫–∞—Ö –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ü–†–û–í–ï–†–Ø–ô: –û—Ç–≤–µ—á–∞–µ—Ç –ª–∏ —Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å –∑–∞–¥–∞–Ω–∏—è –∏–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ
"–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –º—ã—Å–ª—å –Ω–∞ —Ç–µ–º—É"?

–ü–†–ò–ù–¶–ò–ü –¢–û–õ–ö–û–í–ê–ù–ò–Ø –í –ü–û–õ–¨–ó–£ –£–ß–ï–ù–ò–ö–ê:
–í —Å–ø–æ—Ä–Ω—ã—Ö –∏ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö, –∫–æ–≥–¥–∞ —Å—É–∂–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å –∏ –∫–∞–∫ –≤–µ—Ä–Ω–æ–µ,
–∏ –∫–∞–∫ –Ω–µ–≤–µ—Ä–Ω–æ–µ ‚Äî —Ç—Ä–∞–∫—Ç—É–π –í –ü–û–õ–¨–ó–£ —É—á–µ–Ω–∏–∫–∞.
–°–Ω–∏–∂–∞–π –±–∞–ª–ª –¢–û–õ–¨–ö–û –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —è–≤–Ω–æ–π, –±–µ—Å—Å–ø–æ—Ä–Ω–æ–π –æ—à–∏–±–∫–∏.

–ù–ï–ó–ù–ê–ö–û–ú–´–ï –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–ò –ò –¢–ï–û–†–ò–ò:
–ï—Å–ª–∏ —É—á–µ–Ω–∏–∫ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é, —Ç–µ–æ—Ä–∏—é –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ–±–µ –Ω–µ–∑–Ω–∞–∫–æ–º–∞ ‚Äî
–ù–ï –æ—Ç–≤–µ—Ä–≥–∞–π –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –û–Ω–∞ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —É—á–µ–±–Ω–∏–∫–∞—Ö –§–ü–£ –∏–ª–∏ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ.
–°–Ω–∏–∂–∞–π –±–∞–ª–ª –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –£–í–ï–†–ï–ù, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ—à–∏–±–æ—á–Ω–∞.

–í–ê–ñ–ù–û: –ë—É–¥—å —Å—Ç—Ä–æ–≥ –≤ –æ—Ü–µ–Ω–∫–µ, –Ω–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤. –£—á–∏—Ç—ã–≤–∞–π —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

–í–ß–ò–¢–´–í–ê–ô–°–Ø –í –õ–û–ì–ò–ö–£ –†–ê–°–°–£–ñ–î–ï–ù–ò–ô:

‚ùå –ù–ï –ø—Ä–æ–≤–µ—Ä—è–π –ø–æ "–∫–ª—é—á–µ–≤—ã–º —Ñ—Ä–∞–∑–∞–º" –∏–ª–∏ –Ω–∞–ª–∏—á–∏—é —Ç–µ—Ä–º–∏–Ω–æ–≤
‚ùå –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è

‚úÖ –î–æ—á–∏—Ç—ã–≤–∞–π –∫–∞–∂–¥–æ–µ —Å—É–∂–¥–µ–Ω–∏–µ –¥–æ –∫–æ–Ω—Ü–∞
‚úÖ –û—Ü–µ–Ω–∏–≤–∞–π –ª–æ–≥–∏—á–µ—Å–∫—É—é —Ü–µ–ø–æ—á–∫—É: –ø–æ—Å—ã–ª–∫–∞ ‚Üí –∞—Ä–≥—É–º–µ–Ω—Ç ‚Üí –≤—ã–≤–æ–¥
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π, –µ—Å—Ç—å –ª–∏ –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–≤—è–∑—å

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ:
- –ë—É–¥—å –ª–∞–∫–æ–Ω–∏—á–µ–Ω –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã —Ç–∏–ø–∞ "–Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Å—Ç–∞—Ä–∞—Ç—å—Å—è"
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–∏, –∫–∞–∫ –µ–≥–æ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å"""

        # –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–æ–≥–æ—Å—Ç–∏
        if self.strictness == StrictnessLevel.LENIENT:
            base_prompt += "\n\n–£–†–û–í–ï–ù–¨: –ú–Ø–ì–ö–ò–ô - –∑–∞—Å—á–∏—Ç—ã–≤–∞–π —Å—É–∂–¥–µ–Ω–∏—è —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –Ω–µ–¥–æ—á—ë—Ç–∞–º–∏."
        elif self.strictness == StrictnessLevel.STANDARD:
            base_prompt += "\n\n–£–†–û–í–ï–ù–¨: –°–¢–ê–ù–î–ê–†–¢–ù–´–ô - —Å–ª–µ–¥—É–π –∫—Ä–∏—Ç–µ—Ä–∏—è–º, –Ω–æ –ø—Ä–æ—â–∞–π –º–µ–ª–∫–∏–µ –Ω–µ–¥–æ—á—ë—Ç—ã."
        elif self.strictness == StrictnessLevel.STRICT:
            base_prompt += "\n\n–£–†–û–í–ï–ù–¨: –°–¢–†–û–ì–ò–ô - —Ç—Ä–µ–±—É–π –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫—Ä–∏—Ç–µ—Ä–∏—è–º –§–ò–ü–ò."
        elif self.strictness == StrictnessLevel.EXPERT:
            base_prompt += "\n\n–£–†–û–í–ï–ù–¨: –≠–ö–°–ü–ï–†–¢–ù–´–ô - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–≥–æ—Å—Ç—å, –∫–∞–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —ç–∫–∑–∞–º–µ–Ω–µ."
        
        return base_prompt
    
    async def evaluate(self, answer: str, topic: str, **kwargs) -> EvaluationResult:
        """–û—Ü–µ–Ω–∫–∞ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ YandexGPT."""
        task_text = kwargs.get('task_text', '')
        
        # –ï—Å–ª–∏ AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—É—é –æ—Ü–µ–Ω–∫—É
        if not AI_EVALUATOR_AVAILABLE or not self.config:
            return self._basic_evaluation(answer, topic)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        evaluation_prompt = f"""–ü—Ä–æ–≤–µ—Ä—å –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ 20 –ï–ì–≠.

–ó–ê–î–ê–ù–ò–ï: {task_text}

–¢–ï–ú–ê: {topic}

–û–¢–í–ï–¢ –£–ß–ï–ù–ò–ö–ê:
{answer}

–ü–û–®–ê–ì–û–í–´–ô –ê–õ–ì–û–†–ò–¢–ú:
1. –û–ø—Ä–µ–¥–µ–ª–∏, —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Å—É–∂–¥–µ–Ω–∏–π –ø—Ä–∏–≤—ë–ª —É—á–µ–Ω–∏–∫
2. –ï—Å–ª–∏ –±–æ–ª—å—à–µ 3 - –ø—Ä–æ–≤–µ—Ä—å –í–°–ï –Ω–∞ –æ—à–∏–±–∫–∏ (–ª—é–±–∞—è —Å–µ—Ä—å—ë–∑–Ω–∞—è –æ—à–∏–±–∫–∞ = 0 –±–∞–ª–ª–æ–≤ –∑–∞ –≤—Å—ë)
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—É–∂–¥–µ–Ω–∏—è –æ—Ü–µ–Ω–∏:
   - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ—Å—Ç—å (–Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤)
   - –ù–∞–ª–∏—á–∏–µ –æ–±–æ–±—â–µ–Ω–∏—è
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–¥–∞–Ω–∏—é
   - –õ–æ–≥–∏—á–Ω–æ—Å—Ç—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
   - –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å (–Ω–µ –º–µ–Ω–µ–µ 5 —Å–ª–æ–≤)

–£–ß–ò–¢–´–í–ê–ô:
- –°—É–∂–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–º–∏
- –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞—Ç, –∏–º—ë–Ω, –Ω–∞–∑–≤–∞–Ω–∏–π
- –î–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±–æ–±—â–∞—é—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
```json
{{
    "score": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 3,
    "valid_arguments_count": –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π,
    "total_arguments": –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–∂–¥–µ–Ω–∏–π –≤ –æ—Ç–≤–µ—Ç–µ,
    "penalty_applied": true/false,
    "penalty_reason": "–ø—Ä–∏—á–∏–Ω–∞ —à—Ç—Ä–∞—Ñ–∞" –∏–ª–∏ null,
    "valid_arguments": [
        {{
            "number": –Ω–æ–º–µ—Ä —Å—É–∂–¥–µ–Ω–∏—è,
            "text": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—É—Ç–∏ —Å—É–∂–¥–µ–Ω–∏—è (–¥–æ 50 —Å–ª–æ–≤)",
            "has_generalization": true/false,
            "comment": "–ø–æ—á–µ–º—É –∑–∞—Å—á–∏—Ç–∞–Ω–æ"
        }}
    ],
    "invalid_arguments": [
        {{
            "number": –Ω–æ–º–µ—Ä —Å—É–∂–¥–µ–Ω–∏—è,
            "text": "–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—É—Ç–∏ —Å—É–∂–¥–µ–Ω–∏—è (–¥–æ 50 —Å–ª–æ–≤)",
            "reason": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—á–µ–º—É –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω–æ",
            "is_concrete_example": true/false,
            "improvement": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Å—É–∂–¥–µ–Ω–∏–µ"
        }}
    ],
    "feedback": "–∫—Ä–∞—Ç–∫–∏–π –æ–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
    "suggestions": ["–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –æ—Ç–≤–µ—Ç–∞", "–µ—â—ë –æ–¥–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"],
    "factual_errors": ["–æ—à–∏–±–∫–∞ 1", "–æ—à–∏–±–∫–∞ 2"] –∏–ª–∏ []
}}
```

–í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–¢–í–ï–¢–£:
1. –í "feedback" –ø–∏—à–∏ –∫—Ä–∞—Ç–∫–æ, —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ
2. –í "suggestions" –¥–∞–≤–∞–π –ö–û–ù–ö–†–ï–¢–ù–´–ï —Å–æ–≤–µ—Ç—ã, –∞ –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–∑–∞—Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ —Å—É–∂–¥–µ–Ω–∏—è –≤ "improvement" –Ω–∞–ø–∏—à–∏, –ö–ê–ö –ò–ú–ï–ù–ù–û –µ–≥–æ —É–ª—É—á—à–∏—Ç—å
4. –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ—Ä–∞–∑—ã

–í–ê–ñ–ù–û: –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON –≤ –±–ª–æ–∫–µ –∫–æ–¥–∞, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞."""

        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–∏—Å YandexGPT
            async with YandexGPTService(self.config) as service:
                result = await service.get_json_completion(
                    prompt=evaluation_prompt,
                    system_prompt=self.get_system_prompt(),
                    temperature=self.config.temperature
                )
                
                if result:
                    return self._parse_response(result, answer, topic)
                else:
                    logger.error("Failed to get JSON response from YandexGPT")
                    return self._basic_evaluation(answer, topic)
                    
        except Exception as e:
            logger.error(f"Error in Task20 evaluation: {e}")
            return self._basic_evaluation(answer, topic)
    
    def _basic_evaluation(self, answer: str, topic: str) -> EvaluationResult:
        """–ë–∞–∑–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑ AI."""
        arguments = [arg.strip() for arg in answer.split('\n') if arg.strip()]
        score = min(len(arguments), 3) if len(arguments) <= 3 else 2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
        concrete_indicators = [
            '–Ω–∞–ø—Ä–∏–º–µ—Ä', '–≤ 20', '–≥–æ–¥—É', '–∫–æ–º–ø–∞–Ω–∏—è', '—Å—Ç—Ä–∞–Ω–∞',
            '—Ä–æ—Å—Å–∏—è', '—Å—à–∞', '–∫–∏—Ç–∞–π', '—Ñ—Ä–∞–Ω—Ü–∏—è', '–≥–µ—Ä–º–∞–Ω–∏—è'
        ]
        
        has_concrete = any(indicator in answer.lower() for indicator in concrete_indicators)
        if has_concrete and score > 0:
            score = max(0, score - 1)
        
        return EvaluationResult(
            criteria_scores={"–ö1": score},
            total_score=score,
            max_score=3,
            feedback=f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å—É–∂–¥–µ–Ω–∏–π: {len(arguments)}",
            detailed_feedback={  # –ò–∑–º–µ–Ω–µ–Ω–æ: detailed_analysis -> detailed_feedback
                "arguments_count": len(arguments),
                "score": score,
                "has_concrete_examples": has_concrete
            },
            suggestions=[
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª—å—à–µ –æ–±–æ–±—â–∞—é—â–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
                "–ò–∑–±–µ–≥–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤",
                "–§–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è"
            ],
            factual_errors=[]
        )
    
    def _parse_response(self, response: Dict[str, Any], answer: str, topic: str) -> EvaluationResult:
            """–ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç YandexGPT."""
            try:
                score = response.get("score", 0)
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Ç–∫—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
                feedback = response.get("feedback", "")
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏—è—Ö (–∫—Ä–∞—Ç–∫–æ)
                if response.get("valid_arguments"):
                    feedback += f"\n\n‚úÖ <b>–ó–∞—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Å—É–∂–¥–µ–Ω–∏—è:</b>\n"
                    for i, arg in enumerate(response["valid_arguments"], 1):
                        feedback += f"{i}. {arg.get('comment', '–°—É–∂–¥–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')}\n"
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏—è—Ö —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏
                if response.get("invalid_arguments"):
                    feedback += f"\n\n‚ùå <b>–ù–µ –∑–∞—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Å—É–∂–¥–µ–Ω–∏—è:</b>\n"
                    for arg in response["invalid_arguments"]:
                        feedback += f"{arg['number']}. {arg.get('reason', '–ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º')}\n"
                        if arg.get('improvement'):
                            feedback += f"   üí° <i>–°–æ–≤–µ—Ç: {arg['improvement']}</i>\n"
                
                # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à—Ç—Ä–∞—Ñ–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if response.get("penalty_applied"):
                    feedback += f"\n‚ö†Ô∏è <b>–ü—Ä–∏–º–µ–Ω—ë–Ω —à—Ç—Ä–∞—Ñ:</b> {response.get('penalty_reason', '')}"
                
                return EvaluationResult(
                    criteria_scores={"–ö1": score},
                    total_score=score,
                    max_score=3,
                    feedback=feedback,
                    detailed_feedback=response,  # –ò–∑–º–µ–Ω–µ–Ω–æ: detailed_analysis -> detailed_feedback
                    suggestions=response.get("suggestions", []),
                    factual_errors=response.get("factual_errors", [])
                )
                
            except Exception as e:
                logger.error(f"Error parsing YandexGPT response: {e}")
                return self._basic_evaluation(answer, topic)