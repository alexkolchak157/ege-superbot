"""
–®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è retention-–∫–∞–º–ø–∞–Ω–∏–π.

–°–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ countdown –¥–æ –ï–ì–≠.
"""

import logging
from datetime import datetime, date
from typing import Dict, Any, Optional, List
from enum import Enum

logger = logging.getLogger(__name__)

# –î–∞—Ç–∞ –ï–ì–≠ –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é
EGE_DATE = date(2026, 6, 11)


def days_until_ege() -> int:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –ï–ì–≠"""
    today = date.today()
    delta = (EGE_DATE - today).days
    return max(0, delta)  # –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º


class NotificationTrigger(Enum):
    """–¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    # Bounced —Å–µ–≥–º–µ–Ω—Ç
    BOUNCED_DAY1 = "bounced_day1"
    BOUNCED_DAY3 = "bounced_day3"
    BOUNCED_DAY7 = "bounced_day7"  # –î–û–ë–ê–í–õ–ï–ù–û: —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

    # Late Bounced —Å–µ–≥–º–µ–Ω—Ç (Resurrection –∫–∞–º–ø–∞–Ω–∏—è)
    LATE_BOUNCED_RESURRECTION = "late_bounced_resurrection"

    # Curious —Å–µ–≥–º–µ–Ω—Ç
    CURIOUS_DAY3 = "curious_day3"
    CURIOUS_DAY7 = "curious_day7"

    # Active Free —Å–µ–≥–º–µ–Ω—Ç
    ACTIVE_FREE_DAY10 = "active_free_day10"
    ACTIVE_FREE_DAY20 = "active_free_day20"
    ACTIVE_FREE_LIMIT_WARNING = "active_free_limit_warning"

    # Trial Users —Å–µ–≥–º–µ–Ω—Ç
    TRIAL_DAY3 = "trial_day3"
    TRIAL_EXPIRING_2DAYS = "trial_expiring_2days"
    TRIAL_EXPIRING_1DAY = "trial_expiring_1day"
    TRIAL_EXPIRED = "trial_expired"

    # Paying Inactive —Å–µ–≥–º–µ–Ω—Ç
    PAYING_INACTIVE_DAY3 = "paying_inactive_day3"
    PAYING_INACTIVE_DAY7 = "paying_inactive_day7"
    PAYING_INACTIVE_DAY14 = "paying_inactive_day14"

    # Churn Risk —Å–µ–≥–º–µ–Ω—Ç
    CHURN_RISK_7DAYS = "churn_risk_7days"
    CHURN_RISK_3DAYS = "churn_risk_3days"
    CHURN_RISK_1DAY = "churn_risk_1day"

    # Cancelled —Å–µ–≥–º–µ–Ω—Ç
    CANCELLED_DAY1 = "cancelled_day1"
    CANCELLED_DAY3 = "cancelled_day3"
    CANCELLED_DAY7 = "cancelled_day7"


class NotificationTemplate:
    """–®–∞–±–ª–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""

    def __init__(self, text: str, buttons: Optional[List[Dict[str, str]]] = None):
        """
        Args:
            text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ {var})
            buttons: –°–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ [{"text": "...", "callback_data": "..."}]
        """
        self.text = text
        self.buttons = buttons or []

    def render(self, variables: Dict[str, Any]) -> str:
        """
        –†–µ–Ω–¥–µ—Ä–∏—Ç —à–∞–±–ª–æ–Ω —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

        Args:
            variables: –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏

        Returns:
            –û—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
        """
        # –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ days_to_ege
        variables['days_to_ege'] = days_until_ege()

        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∫–ª–æ–Ω–µ–Ω–∏—è –¥–Ω–µ–π
        days = variables.get('days_to_ege', 0)
        if days % 10 == 1 and days % 100 != 11:
            variables['days_word'] = '–¥–µ–Ω—å'
        elif days % 10 in [2, 3, 4] and days % 100 not in [12, 13, 14]:
            variables['days_word'] = '–¥–Ω—è'
        else:
            variables['days_word'] = '–¥–Ω–µ–π'

        try:
            return self.text.format(**variables)
        except KeyError as e:
            logger.error(f"Missing variable in template: {e}")
            return self.text


# ==================== BOUNCED –°–ï–ì–ú–ï–ù–¢ ====================

BOUNCED_TEMPLATES = {
    NotificationTrigger.BOUNCED_DAY1: NotificationTemplate(
        text="""üëã {first_name}, —Å–ø–∞—Å–∏–±–æ —á—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è!

–ù–æ –∑–∞–º–µ—Ç–∏–ª–∏ ‚Äî —Ç—ã –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª ü§î

<b>–î–∞–≤–∞–π –∏—Å–ø—Ä–∞–≤–∏–º –∑–∞ 2 –º–∏–Ω—É—Ç—ã:</b>

üéØ –†–µ—à–∏ 3 –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–∞
üí° –ü–æ–ª—É—á–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
üéÅ –ü–æ–ø—Ä–æ–±—É–π AI-–ø—Ä–æ–≤–µ—Ä–∫—É –ë–ï–°–ü–õ–ê–¢–ù–û

<b>–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç:</b>
–£—á–µ–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—à–∞—é—Ç –ø–µ—Ä–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –¥–µ–Ω—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –≤ 5 —Ä–∞–∑ —á–∞—â–µ –≥–æ—Ç–æ–≤—è—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏ —Å–¥–∞—é—Ç –Ω–∞ 80+

‚è∞ –î–æ –ï–ì–≠: <b>{days_to_ege} {days_word}</b>
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞ —Å—á–µ—Ç—É!

<i>–ü–æ–ø—Ä–æ–±—É–π —Å–µ–π—á–∞—Å, –ø–æ–∫–∞ –º–æ—Ç–∏–≤–∞—Ü–∏—è –µ—Å—Ç—å üî•</i>""",
        buttons=[
            {"text": "üöÄ –ù–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å (2 –º–∏–Ω)", "callback_data": "start_onboarding"},
            {"text": "üíé –£–∑–Ω–∞—Ç—å –ø—Ä–æ trial –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_trial_7days"}
        ]
    ),

    NotificationTrigger.BOUNCED_DAY3: NotificationTemplate(
        text="""üéØ {first_name}, —Ç—ã —É–ø—É—Å–∫–∞–µ—à—å —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ

–ü–æ–∫–∞ —Ç—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–ª:
‚Ä¢ 47 —É—á–µ–Ω–∏–∫–æ–≤ —Ä–µ—à–∏–ª–∏ –ø–µ—Ä–≤—ã–µ 10 –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ 23 —É–∂–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ AI-–ø—Ä–æ–≤–µ—Ä–∫—É
‚Ä¢ 12 –æ—Ñ–æ—Ä–º–∏–ª–∏ trial –∑–∞ 1‚ÇΩ

<b>–ê —Ç—ã –≤—Å–µ –µ—â—ë –Ω–∞ —Å—Ç–∞—Ä—Ç–µ</b> üòî

üéÅ <b>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è:</b>
3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ –°–ï–ì–û–î–ù–Ø
–ü—Ä–æ–≤–µ—Ä—å –∑–∞–¥–∞–Ω–∏–µ 24 –∏–ª–∏ 25 –∫–∞–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ï–ì–≠!

‚è∞ –î–æ –ï–ì–≠: <b>{days_to_ege} {days_word}</b>

<i>–ù–µ –¥–∞–π –¥—Ä—É–≥–∏–º –æ–±–æ–≥–Ω–∞—Ç—å —Ç–µ–±—è üèÉ‚Äç‚ôÇÔ∏è</i>""",
        buttons=[
            {"text": "üî• –ù–∞—á–∞—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É", "callback_data": "start_onboarding"},
            {"text": "üíé –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å AI –±–µ—Å–ø–ª–∞—Ç–Ω–æ", "callback_data": "choose_task24"},
            {"text": "üéÅ Trial –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_trial_7days"}
        ]
    ),

    NotificationTrigger.BOUNCED_DAY7: NotificationTemplate(
        text="""‚ö†Ô∏è {first_name}, —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

–ü—Ä–æ—à–ª–∞ –Ω–µ–¥–µ–ª—è —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ —Ç—ã —Ç–∞–∫ –∏ –Ω–µ –Ω–∞—á–∞–ª.

–í–æ—Ç —á—Ç–æ —Ç—ã —É–ø—É—Å–∫–∞–µ—à—å:
‚ùå 1000+ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
‚ùå –ò–ò-–ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ï–ì–≠
‚ùå 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é
‚ùå –®–∞–Ω—Å –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –≤–æ–≤—Ä–µ–º—è

‚è∞ –î–æ –ï–ì–≠ –æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ {days_to_ege} {days_word}

üö® <b>–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</b>
–ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –º—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ–º –ø–∏—Å–∞—Ç—å.

<i>–ü–æ–ø—Ä–æ–±—É–π —Å–µ–π—á–∞—Å –∏–ª–∏ –ø–æ—Ç–µ—Ä—è–µ—à—å —à–∞–Ω—Å –Ω–∞–≤—Å–µ–≥–¥–∞</i>""",
        buttons=[
            {"text": "üî• –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å", "callback_data": "start_onboarding"},
            {"text": "üíé –£–∑–Ω–∞—Ç—å –ø—Ä–æ trial –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_trial_7days"},
            {"text": "‚ùå –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—è –Ω–∞–≤—Å–µ–≥–¥–∞", "callback_data": "notifications_disable"}
        ]
    )
}

# ==================== LATE BOUNCED –°–ï–ì–ú–ï–ù–¢ (RESURRECTION) ====================

LATE_BOUNCED_TEMPLATES = {
    NotificationTrigger.LATE_BOUNCED_RESURRECTION: NotificationTemplate(
        text="""üî• {first_name}, –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è! –ú—ã –æ–±–Ω–æ–≤–∏–ª–∏ –±–æ—Ç–∞

–ü—Ä–æ—à–ª–æ {days_since_registration} {days_word} —Å —Ç–≤–æ–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

<b>–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:</b>
‚ú® –ù–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π onboarding - —É–∑–Ω–∞–π —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∑–∞ 3 –º–∏–Ω—É—Ç—ã
üéÅ 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ –ö–ê–ñ–î–£–Æ –Ω–µ–¥–µ–ª—é
üíé Trial –¥–æ—Å—Ç—É–ø –∑–∞ 1‚ÇΩ –Ω–∞ —Ü–µ–ª—É—é –Ω–µ–¥–µ–ª—é
üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–≤–æ–∏—Ö –æ—à–∏–±–æ–∫

<b>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ–±—è:</b>
–ü–æ–ø—Ä–æ–±—É–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º AI-–ø—Ä–æ–≤–µ—Ä–∫–∞–º

‚è∞ –î–æ –ï–ì–≠: <b>{days_to_ege} {days_word}</b>

‚ö†Ô∏è <b>–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</b>
–ú—ã –Ω–µ –±—É–¥–µ–º –±–æ–ª—å—à–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ –∫—Ä—É—Ç–∞—è.

<i>–î–∞–π –±–æ—Ç—É –≤—Ç–æ—Ä–æ–π —à–∞–Ω—Å - –æ–Ω —ç—Ç–æ–≥–æ —Å—Ç–æ–∏—Ç üöÄ</i>""",
        buttons=[
            {"text": "üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é", "callback_data": "start_onboarding"},
            {"text": "üíé –£–∑–Ω–∞—Ç—å –ø—Ä–æ trial –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_trial_7days"},
            {"text": "‚ùå –ë–æ–ª—å—à–µ –Ω–µ –ø–∏—Å–∞—Ç—å", "callback_data": "notifications_disable"}
        ]
    )
}

# ==================== CURIOUS –°–ï–ì–ú–ï–ù–¢ ====================

CURIOUS_TEMPLATES = {
    NotificationTrigger.CURIOUS_DAY3: NotificationTemplate(
        text="""üéâ {first_name}, –æ—Ç–ª–∏—á–Ω–æ –Ω–∞—á–∞–ª! {answered_total} –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–µ—à–µ–Ω–æ!

<b>–ù–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞:</b>
–¢—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ –ø–æ–ª–ø—É—Ç–∏ –∫ –ø–µ—Ä–≤–æ–π —Ü–µ–ª–∏ üòî

<b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–∞:</b>
‚Ä¢ –†–µ—à–∏–ª–∏ 10+ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí 80% –æ—Å—Ç–∞—é—Ç—Å—è –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è
‚Ä¢ –†–µ—à–∏–ª–∏ 5-9 –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí —Ç–æ–ª—å–∫–æ 20% –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
‚Ä¢ –¢—ã —Å–µ–π—á–∞—Å –∑–¥–µ—Å—å ‚Üí {answered_total} –≤–æ–ø—Ä–æ—Å–æ–≤

–¢–µ–±–µ –æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ <b>{questions_to_milestone} –≤–æ–ø—Ä–æ—Å–æ–≤</b> –¥–æ –≤–∞–∂–Ω–æ–π –≤–µ—Ö–∏! üéØ

üéÅ –£ —Ç–µ–±—è –µ—Å—Ç—å <b>{checks_remaining} –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö AI-–ø—Ä–æ–≤–µ—Ä–æ–∫</b> —Å–µ–≥–æ–¥–Ω—è

‚è∞ –î–æ –ï–ì–≠: {days_to_ege} {days_word}

<i>–ù–µ –¥–∞–π —Å–µ–±–µ —Å—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π - –ø—Ä–æ–¥–æ–ª–∂–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</i>""",
        buttons=[
            {"text": "üî• –†–µ—à–∏—Ç—å 5 –≤–æ–ø—Ä–æ—Å–æ–≤ (10 –º–∏–Ω)", "callback_data": "choose_test_part"},
            {"text": "üíé Trial –∑–∞ 1‚ÇΩ –Ω–∞ –Ω–µ–¥–µ–ª—é", "callback_data": "subscribe_trial_7days"}
        ]
    ),

    NotificationTrigger.CURIOUS_DAY7: NotificationTemplate(
        text="""üìâ {first_name}, –Ω–µ–¥–µ–ª—è –ø—Ä–æ—à–ª–∞... –∞ —Ç—ã —Ç–∞–∫ –∏ –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è

<b>–ü–æ–∫–∞ —Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª:</b>
‚Ä¢ 89 —É—á–µ–Ω–∏–∫–æ–≤ —Ä–µ—à–∏–ª–∏ –ø–æ 50+ –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ 34 –æ—Ñ–æ—Ä–º–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É
‚Ä¢ 12 —É–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–±–Ω–∏–∫–∏ –Ω–∞ 15+ –±–∞–ª–ª–æ–≤

<b>–ê —Ç–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å?</b>
–í—Å–µ–≥–æ {answered_total} –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è üòî

‚ö†Ô∏è <b>–ö—Ä–∏—Ç–∏—á–Ω–æ:</b>
–î–æ –ï–ì–≠ –æ—Å—Ç–∞–ª–æ—Å—å {days_to_ege} {days_word}
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏—è = –º–∏–Ω—É—Å 1-2 –±–∞–ª–ª–∞ –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ

üéÅ <b>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:</b>
Trial –∑–∞ 1‚ÇΩ + 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ–≥–æ–¥–Ω—è

<i>–í–µ—Ä–Ω–∏—Å—å –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ üö®</i>""",
        buttons=[
            {"text": "üî• –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ", "callback_data": "to_main_menu"},
            {"text": "üíé Trial –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_trial_7days"},
            {"text": "‚ùå –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—è", "callback_data": "notifications_disable"}
        ]
    )
}

# ==================== ACTIVE FREE –°–ï–ì–ú–ï–ù–¢ ====================

ACTIVE_FREE_TEMPLATES = {
    NotificationTrigger.ACTIVE_FREE_DAY10: NotificationTemplate(
        text="""üåü {first_name}, —É —Ç–µ–±—è –æ—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å!

–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é:
‚úÖ {answered_week} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
üìà –°—Ç—Ä–∏–∫: {current_streak} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
üíØ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª: —Ä–∞—Å—Ç—ë—Ç!

–ó–Ω–∞–µ—à—å —á—Ç–æ? –£—á–µ–Ω–∏–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –≥–æ—Ç–æ–≤—è—Ç—Å—è –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ.
–í–æ—Ç –ø–æ—á–µ–º—É:

‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ AI-–ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å–µ–π—á–∞—Å —É —Ç–µ–±—è —Ç–æ–ª—å–∫–æ 3/–¥–µ–Ω—å)
‚Ä¢ –ó–∞–¥–∞–Ω–∏—è 19-25 (—Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ, –Ω–æ –¥–∞—é—Ç 18 –±–∞–ª–ª–æ–≤!)
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç

üéÅ –ü–æ–ø—Ä–æ–±—É–π 7 –¥–Ω–µ–π –∑–∞ 1‚ÇΩ""",
        buttons=[
            {"text": "üéÅ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_start"},
            {"text": "üíé –£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ", "callback_data": "subscribe_start"}
        ]
    ),

    NotificationTrigger.ACTIVE_FREE_DAY20: NotificationTemplate(
        text="""üî• –í–∞—É, {first_name}! –¢—ã –≤ —Ç–æ–ø-10% —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤!

–¢–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
üèÜ –†–µ—à–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: {answered_total}
üìä –î–Ω–µ–π –ø–æ–¥—Ä—è–¥: {current_streak}
‚≠ê –¢—ã –º–æ–ª–æ–¥–µ—Ü!

–ù–æ –µ—Å—Ç—å –Ω—é–∞–Ω—Å...
–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å –ï–ì–≠ –¥–∞—ë—Ç 60% –±–∞–ª–ª–æ–≤, –∞ —É —Ç–µ–±—è –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ 3 –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –Ω–µ–¥–µ–ª—é.

üéØ –£—á–µ–Ω–∏–∫–∏ —Å Premium —Å–¥–∞—é—Ç –Ω–∞ 90+:
‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ AI
‚Ä¢ –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ –≤—Å–µ–º —Ç–µ–º–∞–º
‚Ä¢ –õ–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–æ –ï–ì–≠ {days_to_ege} {days_word}. –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å!

üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–æ–ø–æ–≤—ã—Ö: —Å–∫–∏–¥–∫–∞ 20%
–ü—Ä–æ–º–æ–∫–æ–¥: TOP20""",
        buttons=[
            {"text": "üíé –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∏–¥–∫—É", "callback_data": "subscribe_start"},
            {"text": "üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É", "callback_data": "to_main_menu"}
        ]
    ),

    NotificationTrigger.ACTIVE_FREE_LIMIT_WARNING: NotificationTemplate(
        text="""‚ö†Ô∏è {first_name}, –æ—Å—Ç–∞–ª–∞—Å—å 1 –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞!

–¢—ã –∞–∫—Ç–∏–≤–Ω–æ –≥–æ—Ç–æ–≤–∏—à—å—Å—è - —ç—Ç–æ –∫—Ä—É—Ç–æ! üî•
–ù–æ —á–µ—Ä–µ–∑ 1 –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–º–∏—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –¥–æ –∑–∞–≤—Ç—Ä–∞.

üí° –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ —Å–∞–º–æ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º!

–° –ø–æ–¥–ø–∏—Å–∫–æ–π:
‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ AI
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Å–µ–∫—É–Ω–¥—ã
‚Ä¢ –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–∞–∂–¥–æ–π –æ—à–∏–±–∫–∏

üéÅ –ü–æ–ø—Ä–æ–±—É–π 7 –¥–Ω–µ–π –∑–∞ 1‚ÇΩ
–î–æ –ï–ì–≠ {days_to_ege} {days_word} - –Ω–µ —Ç–µ—Ä—è–π —Ç–µ–º–ø!""",
        buttons=[
            {"text": "üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞ 1‚ÇΩ", "callback_data": "subscribe_start"},
            {"text": "‚è∞ –ü–æ–¥–æ–∂–¥—É –¥–æ –∑–∞–≤—Ç—Ä–∞", "callback_data": "notifications_snooze"}
        ]
    )
}

# ==================== TRIAL USERS –°–ï–ì–ú–ï–ù–¢ ====================

TRIAL_TEMPLATES = {
    NotificationTrigger.TRIAL_DAY3: NotificationTemplate(
        text="""üëã {first_name}, –∫–∞–∫ —Ç–µ–±–µ trial?

–¢—ã —É–∂–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏?

‚úÖ AI-–ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–¥–∞–Ω–∏–π 19-25
‚úÖ –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚úÖ –î–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É

–ï—Å–ª–∏ –µ—â—ë –Ω–µ—Ç - —Å–∫–æ—Ä–µ–µ —Ç–µ—Å—Ç–∏—Ä—É–π!
–î–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∏–∞–ª–∞: {days_until_expiry} {days_word}

üí° –í–æ–ø—Ä–æ—Å—ã? –ù–∞–ø–∏—à–∏ @obshestvonapalcahsupport""",
        buttons=[
            {"text": "üéØ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ", "callback_data": "choose_task24"},
            {"text": "üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "callback_data": "to_main_menu"}
        ]
    ),

    NotificationTrigger.TRIAL_EXPIRING_2DAYS: NotificationTemplate(
        text="""‚è∞ {first_name}, —á–µ—Ä–µ–∑ 2 –¥–Ω—è —Ç–≤–æ–π trial –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è

–ó–∞ —ç—Ç–∏ –¥–Ω–∏ —Ç—ã:
‚úÖ –†–µ—à–∏–ª {answered_total} –∑–∞–¥–∞–Ω–∏–π –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏
‚úÖ –ü–æ–ª—É—á–∏–ª {ai_checks_total} –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –æ—Ç AI
‚úÖ –£–ª—É—á—à–∏–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!

üéØ –£—á–µ–Ω–∏–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π —Å–¥–∞—é—Ç –Ω–∞ 15+ –±–∞–ª–ª–æ–≤ –≤—ã—à–µ!

–ü—Ä–æ–¥–ª–∏ —Å–µ–π—á–∞—Å —Å–æ —Å–∫–∏–¥–∫–æ–π 20% –Ω–∞ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü:
–í–º–µ—Å—Ç–æ 249‚ÇΩ ‚Üí –≤—Å–µ–≥–æ 199‚ÇΩ

–ü—Ä–æ–º–æ–∫–æ–¥: TRIAL20

‚è∞ –î–æ –ï–ì–≠: {days_to_ege} {days_word}""",
        buttons=[
            {"text": "üíé –ü—Ä–æ–¥–ª–∏—Ç—å —Å–æ —Å–∫–∏–¥–∫–æ–π", "callback_data": "subscribe_start"},
            {"text": "‚è∞ –ù–∞–ø–æ–º–Ω–∏—Ç—å –∑–∞–≤—Ç—Ä–∞", "callback_data": "notifications_snooze"}
        ]
    ),

    NotificationTrigger.TRIAL_EXPIRING_1DAY: NotificationTemplate(
        text="""üö® {first_name}, –ó–ê–í–¢–†–ê trial –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è!

–ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ —Ç—ã –ø–æ—Ç–µ—Ä—è–µ—à—å:
‚ùå –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ AI-–ø—Ä–æ–≤–µ—Ä–∫–∏
‚ùå –ó–∞–¥–∞–Ω–∏—è 19-25
‚ùå –î–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
‚ùå –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å:
üìà {answered_total} –∑–∞–¥–∞–Ω–∏–π —Ä–µ—à–µ–Ω–æ
üéØ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª —Ä–∞—Å—Ç—ë—Ç

–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è! –ü—Ä–æ–¥–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É —Å–æ —Å–∫–∏–¥–∫–æ–π 25%:

üéÅ LASTDAY25 ‚Äî –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ 25% —Å–∫–∏–¥–∫—É
(–¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è)

–î–æ –ï–ì–≠ {days_to_ege} {days_word}. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤–∞–∂–µ–Ω!""",
        buttons=[
            {"text": "üî• –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å LASTDAY25", "callback_data": "subscribe_start"},
            {"text": "‚ùå –û—Ç–∫–∞–∂—É—Å—å –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏", "callback_data": "trial_cancel_confirm"}
        ]
    ),

    NotificationTrigger.TRIAL_EXPIRED: NotificationTemplate(
        text="""‚è∞ {first_name}, —Ç–≤–æ–π trial –∏—Å—Ç—ë–∫

–ù–æ –≤–æ—Ç —Ñ–∞–∫—Ç—ã:
‚Ä¢ –¢—ã —Ä–µ—à–∏–ª {answered_total} –∑–∞–¥–∞–Ω–∏–π
‚Ä¢ –¢—ã –≤–∏–¥–µ–ª —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
‚Ä¢ –¢—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

87% —É—á–µ–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–¥–ª–∏–ª–∏ trial,
–≥–æ–≤–æ—Ä—è—Ç: "–õ—É—á—à–µ–µ –≤–ª–æ–∂–µ–Ω–∏–µ –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É"

üéÅ –ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°:
–ü—Ä–æ–¥–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –∏ –ø–æ–ª—É—á–∏:
‚Ä¢ –°–∫–∏–¥–∫—É 30% (–ø—Ä–æ–º–æ–∫–æ–¥: COMEBACK30)
‚Ä¢ +3 –¥–Ω—è –≤ –ø–æ–¥–∞—Ä–æ–∫
‚Ä¢ –ë–æ–Ω—É—Å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Å–ª–æ–∂–Ω—ã–º —Ç–µ–º–∞–º

–î–æ –ï–ì–≠ {days_to_ege} {days_word}. –ù–µ —É–ø—É—Å—Ç–∏ –≤—Ä–µ–º—è!""",
        buttons=[
            {"text": "üíé –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å COMEBACK30", "callback_data": "subscribe_start"},
            {"text": "üÜì –û—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º", "callback_data": "to_main_menu"}
        ]
    )
}

# ==================== PAYING INACTIVE –°–ï–ì–ú–ï–ù–¢ ====================

PAYING_INACTIVE_TEMPLATES = {
    NotificationTrigger.PAYING_INACTIVE_DAY3: NotificationTemplate(
        text="""üí≠ –°–∫—É—á–∞–µ–º –ø–æ —Ç–µ–±–µ, {first_name}!

–ù–µ –∑–∞—Ö–æ–¥–∏–ª —É–∂–µ 3 –¥–Ω—è. –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ?

–ü–æ–∫–∞ —Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª:
‚Ä¢ –î—Ä—É–≥–∏–µ —É—á–µ–Ω–∏–∫–∏ –ø—Ä–æ—à–ª–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º 12 –Ω–æ–≤—ã—Ö —Ç–µ–º
‚Ä¢ –î–æ –ï–ì–≠ –æ—Å—Ç–∞–ª–æ—Å—å {days_to_ege} {days_word}

–£ —Ç–µ–±—è –µ—Å—Ç—å Premium-–¥–æ—Å—Ç—É–ø –¥–æ {subscription_end}.
–î–∞–≤–∞–π –Ω–µ –±—É–¥–µ–º —Ç–µ—Ä—è—Ç—å –µ–≥–æ –∑—Ä—è? üí™

–ü—Ä–æ–¥–æ–ª–∂–∏ —Å –ª—é–±–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:""",
        buttons=[
            {"text": "üéØ –ó–∞–¥–∞–Ω–∏–µ 24 (–ü–ª–∞–Ω)", "callback_data": "choose_task24"},
            {"text": "üìù –¢–µ—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å", "callback_data": "choose_test_part"},
            {"text": "üòî –Ø –ø–µ—Ä–µ–¥—É–º–∞–ª –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è", "callback_data": "feedback_why_inactive"}
        ]
    ),

    NotificationTrigger.PAYING_INACTIVE_DAY7: NotificationTemplate(
        text="""üò¢ {first_name}, –º—ã —á—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ–º –Ω–µ —Ç–∞–∫?

–¢—ã –Ω–µ –∑–∞—Ö–æ–¥–∏—à—å —É–∂–µ –Ω–µ–¥–µ–ª—é, —Ö–æ—Ç—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞.

–ú–æ–∂–µ—Ç –Ω–∞–º —É–ª—É—á—à–∏—Ç—å:
‚Ä¢ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞?
‚Ä¢ –û–±—ä—è—Å–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫?
‚Ä¢ –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π?

üí¨ –ù–∞–ø–∏—à–∏, —á—Ç–æ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è: @obshestvonapalcahsupport
–ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏–º!

–ò–ª–∏ –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å –æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ?
–î–æ –ï–ì–≠ {days_to_ege} {days_word} - –≤—Ä–µ–º—è –Ω–µ –∂–¥—ë—Ç!""",
        buttons=[
            {"text": "üí™ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É", "callback_data": "to_main_menu"},
            {"text": "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É", "url": "https://t.me/obshestvonapalcahsupport"},
            {"text": "üîï –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", "callback_data": "cancel_subscription"}
        ]
    ),

    NotificationTrigger.PAYING_INACTIVE_DAY14: NotificationTemplate(
        text="""‚ö†Ô∏è {first_name}, –ø–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è

–¢—ã –Ω–µ –∑–∞—Ö–æ–¥–∏–ª 2 –Ω–µ–¥–µ–ª–∏.
–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ {subscription_end} ({days_until_expiry} {days_word}).

–ó–∞ —Ç–≤–æ–∏ –¥–µ–Ω—å–≥–∏ —É—Ö–æ–¥—è—Ç –≤–ø—É—Å—Ç—É—é üí∏

–ú–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ?
–ò–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É?

–î–æ –ï–ì–≠ {days_to_ege} {days_word}.
–ï—Å–ª–∏ –Ω–µ —Å–µ–π—á–∞—Å, —Ç–æ –∫–æ–≥–¥–∞?""",
        buttons=[
            {"text": "üöÄ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É", "callback_data": "to_main_menu"},
            {"text": "‚è∏ –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ", "callback_data": "disable_auto_renew"},
            {"text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", "callback_data": "cancel_subscription"}
        ]
    )
}

# ==================== CHURN RISK –°–ï–ì–ú–ï–ù–¢ ====================

CHURN_RISK_TEMPLATES = {
    NotificationTrigger.CHURN_RISK_7DAYS: NotificationTemplate(
        text="""‚ö†Ô∏è {first_name}, —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è

–ó–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ —Ç—ã —Å—Ç–∞–ª –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Ä–µ–∂–µ.
–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ?

–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å:
üìä –†–µ—à–µ–Ω–æ: {answered_total} –∑–∞–¥–∞–Ω–∏–π
üìà –£–ª—É—á—à–µ–Ω–∏–µ: –≤–∏–¥–∏–º—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å!
üéØ –û—Å—Ç–∞–ª–æ—Å—å –¥–æ —Ü–µ–ª–∏: —Å–æ–≤—Å–µ–º —á—É—Ç—å-—á—É—Ç—å

–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è –Ω–∞ –ø–æ–ª–ø—É—Ç–∏!

üéÅ –ü—Ä–æ–¥–ª–∏ —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏ —Å–∫–∏–¥–∫—É 15%:
–ü—Ä–æ–º–æ–∫–æ–¥: STAY15

–î–æ –ï–ì–≠ {days_to_ege} {days_word}""",
        buttons=[
            {"text": "üíé –ü—Ä–æ–¥–ª–∏—Ç—å —Å–æ —Å–∫–∏–¥–∫–æ–π", "callback_data": "subscribe_start"},
            {"text": "üîÑ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ", "callback_data": "enable_auto_renew"}
        ]
    ),

    NotificationTrigger.CHURN_RISK_3DAYS: NotificationTemplate(
        text="""üö® {first_name}, —á–µ—Ä–µ–∑ 3 –¥–Ω—è —Ç—ã –ø–æ—Ç–µ—Ä—è–µ—à—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å!

–ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ —Ç—ã –¥–æ—Å—Ç–∏–≥ —Å –Ω–∞–º–∏:
üìä –†–µ—à–µ–Ω–æ {answered_total} –∑–∞–¥–∞–Ω–∏–π
üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: –≤–∏–¥–µ–Ω —Ä–æ—Å—Ç!
üéØ –¢–≤–æ–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –≤—ã—Ä–æ—Å!

–ù–µ –ø–æ—Ç–µ—Ä—è–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!

–ü—Ä–æ–¥–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É —Å–æ —Å–∫–∏–¥–∫–æ–π 25%:
üéÅ –ü—Ä–æ–º–æ–∫–æ–¥: SAVE25

–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ - —É–¥–æ–±–Ω–æ –∏ –≤—ã–≥–æ–¥–Ω–æ!

–î–æ –ï–ì–≠ {days_to_ege} {days_word}. –ù–µ —Å–¥–∞–≤–∞–π—Å—è —Å–µ–π—á–∞—Å!""",
        buttons=[
            {"text": "üíé –ü—Ä–æ–¥–ª–∏—Ç—å SAVE25", "callback_data": "subscribe_start"},
            {"text": "üîÑ –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ", "callback_data": "enable_auto_renew"},
            {"text": "üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å", "callback_data": "to_main_menu"}
        ]
    ),

    NotificationTrigger.CHURN_RISK_1DAY: NotificationTemplate(
        text="""‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: {first_name}, –ó–ê–í–¢–†–ê –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è!

–ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ —Ç—ã –ø–æ—Ç–µ—Ä—è–µ—à—å:
‚ùå –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ AI-–ø—Ä–æ–≤–µ—Ä–∫–∏
‚ùå –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏
‚ùå –î–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
‚ùå –°–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

–¢—ã –ø—Ä–∞–≤–¥–∞ —Ö–æ—á–µ—à—å –≤—Å—ë –ø–æ—Ç–µ—Ä—è—Ç—å?

üî• –ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°:
–ü—Ä–æ–¥–ª–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏:
‚Ä¢ –°–∫–∏–¥–∫—É 30% (–ø—Ä–æ–º–æ–∫–æ–¥: URGENT30)
‚Ä¢ +5 –¥–Ω–µ–π –≤ –ø–æ–¥–∞—Ä–æ–∫
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏

–î–æ –ï–ì–≠ {days_to_ege} {days_word}!""",
        buttons=[
            {"text": "üö® –ü—Ä–æ–¥–ª–∏—Ç—å URGENT30", "callback_data": "subscribe_start"},
            {"text": "üîÑ –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ (–≤—ã–≥–æ–¥–Ω–µ–µ)", "callback_data": "enable_auto_renew"}
        ]
    )
}

# ==================== CANCELLED –°–ï–ì–ú–ï–ù–¢ ====================

CANCELLED_TEMPLATES = {
    NotificationTrigger.CANCELLED_DAY1: NotificationTemplate(
        text="""üíî –ñ–∞–ª—å, —á—Ç–æ —Ç—ã —É—à—ë–ª, {first_name}

–ú—ã –ø–æ–Ω–∏–º–∞–µ–º - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠ —ç—Ç–æ —Å—Ç—Ä–µ—Å—Å.

–ú–æ–∂–µ—Ç –º—ã —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞–ª–∏ –Ω–µ —Ç–∞–∫?
–ù–∞–ø–∏—à–∏ –Ω–∞–º, –º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–º—Å—è!
@obshestvonapalcahsupport

–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Å—Ç–∞—ë—Ç—Å—è —Å —Ç–æ–±–æ–π:
üìä {answered_total} –∑–∞–¥–∞–Ω–∏–π —Ä–µ—à–µ–Ω–æ
üìà –í–∏–¥–µ–Ω —Ä–æ—Å—Ç!

–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞.
–í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤! üí™""",
        buttons=[
            {"text": "üìù –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ", "callback_data": "to_main_menu"},
            {"text": "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É", "url": "https://t.me/obshestvonapalcahsupport"}
        ]
    ),

    NotificationTrigger.CANCELLED_DAY3: NotificationTemplate(
        text="""ü§î {first_name}, —Ç—ã —É–≤–µ—Ä–µ–Ω –≤ —Ä–µ—à–µ–Ω–∏–∏?

–ò–∑ —É—á–µ–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –∞ –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É–ª–∏—Å—å,
87% –≥–æ–≤–æ—Ä—è—Ç: "–ó—Ä—è –ø–æ—Ç–µ—Ä—è–ª –≤—Ä–µ–º—è"

–§–∞–∫—Ç—ã:
‚Ä¢ –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—ã–ª –æ—Ç–ª–∏—á–Ω—ã–º
‚Ä¢ –¢—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ –±–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç
‚Ä¢ –î–æ –ï–ì–≠ {days_to_ege} {days_word}

üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–ë–Ø:
–í–µ—Ä–Ω–∏—Å—å –∏ –ø–æ–ª—É—á–∏ 40% —Å–∫–∏–¥–∫—É –Ω–∞ –º–µ—Å—è—Ü

–ü—Ä–æ–º–æ–∫–æ–¥: RETURN40
(–¥–µ–π—Å—Ç–≤—É–µ—Ç 3 –¥–Ω—è)""",
        buttons=[
            {"text": "üéÅ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å RETURN40", "callback_data": "subscribe_start"},
            {"text": "üÜì –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ", "callback_data": "to_main_menu"}
        ]
    ),

    NotificationTrigger.CANCELLED_DAY7: NotificationTemplate(
        text="""‚ö° {first_name}, –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –≤–µ—Ä–Ω—É—Ç—å—Å—è!

–ó–∞ –Ω–µ–¥–µ–ª—é –±–µ–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏:
‚Ä¢ –î—Ä—É–≥–∏–µ –ø—Ä–æ—à–ª–∏ 50+ —Ç–µ–º
‚Ä¢ –ú–Ω–æ–≥–∏–µ —É–ª—É—á—à–∏–ª–∏ –±–∞–ª–ª—ã –Ω–∞ 10-15 –ø—É–Ω–∫—Ç–æ–≤
‚Ä¢ –¢—ã –ø–æ—Ç–µ—Ä—è–ª —Ç–µ–º–ø

–î–æ –ï–ì–≠ {days_to_ege} {days_word}.
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞ –≤–µ—Å –∑–æ–ª–æ—Ç–∞!

üî• –°–£–ü–ï–†-–ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï:
50% —Å–∫–∏–¥–∫–∞ + –±–æ–Ω—É—Å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

–ü—Ä–æ–º–æ–∫–æ–¥: LAST50
(–¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è)

–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ - —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω–∞—è —Ü–µ–Ω–∞.""",
        buttons=[
            {"text": "üî• –í–µ—Ä–Ω—É—Ç—å—Å—è LAST50", "callback_data": "subscribe_start"},
            {"text": "‚ùå –¢–æ—á–Ω–æ –Ω–µ –≤–µ—Ä–Ω—É—Å—å", "callback_data": "unsubscribe_forever"}
        ]
    )
}


# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤
ALL_TEMPLATES = {
    **BOUNCED_TEMPLATES,
    **LATE_BOUNCED_TEMPLATES,
    **CURIOUS_TEMPLATES,
    **ACTIVE_FREE_TEMPLATES,
    **TRIAL_TEMPLATES,
    **PAYING_INACTIVE_TEMPLATES,
    **CHURN_RISK_TEMPLATES,
    **CANCELLED_TEMPLATES
}


def get_template(trigger: NotificationTrigger) -> Optional[NotificationTemplate]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —à–∞–±–ª–æ–Ω –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä—É"""
    return ALL_TEMPLATES.get(trigger)
