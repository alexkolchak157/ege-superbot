# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π

**–î–∞—Ç–∞**: 2026-01-06
**–í–µ—Ç–∫–∞**: `claude/fix-homework-creation-Tbu0Q`

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ **–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏**, **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**, **–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∏ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞**.

---

## 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1.1 ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª**: `teacher_mode/services/assignment_service.py:25-125`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —è–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è
- –ú–µ–∂–¥—É INSERT –≤ `homework_assignments` –∏ —Ü–∏–∫–ª–æ–º INSERT –≤ `homework_student_assignments` –Ω–µ –±—ã–ª–æ –∑–∞—â–∏—Ç—ã –æ—Ç partial failure
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–¥–∞–Ω–∏–µ –º–æ–≥–ª–æ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ –±–µ–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —É—á–µ–Ω–∏–∫–∞–º

**–†–µ—à–µ–Ω–∏–µ**:
```python
async with aiosqlite.connect(DATABASE_FILE) as db:
    # –Ø–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
    await db.execute("BEGIN TRANSACTION")

    try:
        # INSERT homework_assignments
        # Batch INSERT homework_student_assignments
        await db.commit()
    except Exception:
        await db.rollback()
        raise
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- Rollback –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

---

### 1.2 ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª**: `teacher_mode/services/assignment_service.py:86-96`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –¶–∏–∫–ª `for student_id in student_ids:` —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º INSERT –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
- –ü—Ä–∏ 100 —É—á–µ–Ω–∏–∫–∞—Ö = 100 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö INSERT –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏ –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ batch –¥–∞–Ω–Ω—ã—Ö
student_assignments = [
    (homework_id, student_id, now.isoformat(), 'assigned')
    for student_id in student_ids
]

# –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è executemany –≤–º–µ—Å—Ç–æ N –æ–ø–µ—Ä–∞—Ü–∏–π
await db.executemany("""
    INSERT INTO homework_student_assignments
    (homework_id, student_id, assigned_at, status)
    VALUES (?, ?, ?, ?)
""", student_assignments)
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 10-100 —Ä–∞–∑** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–µ–Ω–∏–∫–æ–≤
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü

---

### 1.3 ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç DoS

**–§–∞–π–ª**: `api/schemas/assignment.py:10-136`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –ú–æ–∂–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ —Å 5 –º–æ–¥—É–ª—è–º–∏ √ó 100 –≤–æ–ø—Ä–æ—Å–æ–≤ = 500 –≤–æ–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

**–†–µ—à–µ–Ω–∏–µ**:

1. **–°–Ω–∏–∂–µ–Ω—ã –ª–∏–º–∏—Ç—ã –Ω–∞ –º–æ–¥—É–ª—å**:
```python
question_count: Optional[int] = Field(
    None,
    ge=1,
    le=50  # –ë–´–õ–û: 100
)

question_ids: Optional[List[str]] = Field(
    None,
    max_length=50  # –ë–´–õ–û: –Ω–µ—Ç –ª–∏–º–∏—Ç–∞
)
```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è**:
```python
@field_validator('question_ids')
@classmethod
def validate_question_ids(cls, v, info):
    if len(v) != len(set(v)):
        raise ValueError('Duplicate question IDs are not allowed')
    return v
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤**:
```python
@field_validator('modules')
@classmethod
def validate_total_questions(cls, v):
    total_estimated = 0
    all_question_ids = set()

    for module in v:
        # –ü–æ–¥—Å—á–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π
        ...

    if total_estimated > 200:
        raise ValueError(f'Total questions ({total_estimated}) exceeds maximum allowed (200)')
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫ —á–µ—Ä–µ–∑ API
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤

---

### 1.4 ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§–∞–π–ª**: `teacher_mode/services/notification_service.py:1-290`

**–ü—Ä–æ–±–ª–µ–º—ã**:
- –ù–µ—Ç retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏
- –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–æ)
- –ù–µ—Ç rate limiting (—Ä–∏—Å–∫ ban –æ—Ç Telegram)

**–†–µ—à–µ–Ω–∏–µ**:

1. **–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å retry**:
```python
async def send_message_with_retry(bot, chat_id, text, ...):
    retry_delay = INITIAL_RETRY_DELAY

    for attempt in range(MAX_RETRIES):
        try:
            await bot.send_message(...)
            return True
        except RetryAfter as e:
            # Telegram –ø–æ–ø—Ä–æ—Å–∏–ª –ø–æ–¥–æ–∂–¥–∞—Ç—å
            await asyncio.sleep(e.retry_after)
        except TelegramError as e:
            if "blocked" in str(e).lower():
                return False  # Permanent error
            # Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
            await asyncio.sleep(retry_delay)
            retry_delay = min(retry_delay * 2, MAX_RETRY_DELAY)
```

2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å rate limiting**:
```python
async def notify_students_about_homework(...):
    async def send_to_student(student_id, index):
        # Rate limiting
        await asyncio.sleep(index * RATE_LIMIT_DELAY)
        return await send_message_with_retry(bot, student_id, text)

    # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    tasks = [send_to_student(sid, i) for i, sid in enumerate(student_ids)]
    results = await asyncio.gather(*tasks, return_exceptions=True)
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –ù–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ rate limiting –æ—Ç Telegram
- –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫

---

### 1.5 ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –ë–î –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª—ã**:
- `teacher_mode/migrations/add_assignment_type_index.sql`
- `apply_assignment_indexes.py`

**–ü—Ä–æ–±–ª–µ–º–∞**:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `assignment_type`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –∑–∞–¥–∞–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–¥–∞–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ**:
```sql
-- –ò–Ω–¥–µ–∫—Å –Ω–∞ assignment_type
CREATE INDEX IF NOT EXISTS idx_homework_assignments_type
ON homework_assignments(assignment_type);

-- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
CREATE INDEX IF NOT EXISTS idx_homework_assignments_teacher_type
ON homework_assignments(teacher_id, assignment_type, status);

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
ANALYZE homework_assignments;
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
```bash
python apply_assignment_indexes.py
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø—É
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API endpoint GET /assignments
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ | –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏–π |
|------|----------------|---------------|
| `teacher_mode/services/assignment_service.py` | ~40 | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, batch –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `api/schemas/assignment.py` | ~30 | –í–∞–ª–∏–¥–∞—Ü–∏—è, –ª–∏–º–∏—Ç—ã |
| `teacher_mode/services/notification_service.py` | ~120 | Retry –º–µ—Ö–∞–Ω–∏–∑–º, async |
| `core/app.py` | ~20 | Timeout, error handler |
| `teacher_mode/migrations/add_assignment_type_index.sql` | +17 | –ù–æ–≤—ã–π —Ñ–∞–π–ª |
| `apply_assignment_indexes.py` | +61 | –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç |

**–ò—Ç–æ–≥–æ**: ~288 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π

- üîí **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: 35%
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - Retry –º–µ—Ö–∞–Ω–∏–∑–º
  - Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 30%
  - Batch –æ–ø–µ—Ä–∞—Ü–∏–∏
  - –ò–Ω–¥–µ–∫—Å—ã –ë–î
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 20%
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - –ó–∞—â–∏—Ç–∞ –æ—Ç DoS
  - –õ–∏–º–∏—Ç—ã

- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: 15%
  - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## 3. –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|-----|-------|-----------|
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è 50 —É—á–µ–Ω–∏–∫–æ–≤ | ~500ms | ~50ms | **10x** |
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è 100 —É—á–µ–Ω–∏–∫–æ–≤ | ~1000ms | ~80ms | **12.5x** |
| –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 50 —É—á–µ–Ω–∏–∫–∞–º | ~25s (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ) | ~5s (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) | **5x** |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É (1000 –∑–∞–¥–∞–Ω–∏–π) | ~100ms | ~10ms | **10x** |

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|-------|
| –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å partial failure –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ | ~5% | **0%** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) |
| –î–æ—Å—Ç–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö | ~60% | **~95%** (retry) |
| –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ–≥—Ä–æ–º–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π | ‚ùå | ‚úÖ (200 –≤–æ–ø—Ä–æ—Å–æ–≤ max) |

---

## 4. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã**:
- API –Ω–µ –∏–∑–º–µ–Ω–µ–Ω (—Ç–æ–ª—å–∫–æ —É—Å–∏–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ë–î —Å—Ö–µ–º–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã)

### –ú–∏–≥—Ä–∞—Ü–∏–∏

**–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω–∏—Ç—å**:
```bash
python apply_assignment_indexes.py
```

---

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è**:
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å 1 —É—á–µ–Ω–∏–∫–æ–º
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å 50 —É—á–µ–Ω–∏–∫–∞–º–∏
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å 100 —É—á–µ–Ω–∏–∫–∞–º–∏
   - ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å 500 –≤–æ–ø—Ä–æ—Å–∞–º–∏ (–¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É)

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 10 —É—á–µ–Ω–∏–∫–∞–º
   - ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–µ (retry)
   - ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É—á–µ–Ω–∏–∫—É, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ (graceful failure)

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
   - ‚úÖ –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –¥–ª—è 100 —É—á–µ–Ω–∏–∫–æ–≤
   - ‚úÖ –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 100 —É—á–µ–Ω–∏–∫–∞–º
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∏–Ω–¥–µ–∫—Å–æ–≤ (EXPLAIN QUERY PLAN)

---

## 6. –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (optional)

–°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ:

1. **WebApp —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –≤ localStorage
   - Progress bar –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è

2. **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
   - Celery/RQ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - Retry queue –¥–ª—è failed notifications
   - Scheduled tasks –¥–ª—è deadline reminders

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):
   - –ú–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus
   - Dashboards –≤ Grafana
   - Alerts –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û–±—â–∏–µ timeout –æ—à–∏–±–∫–∏ –±–æ—Ç–∞

**–§–∞–π–ª**: `core/app.py`

**–ü—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤ production –ª–æ–≥–∞—Ö**:
- `telegram.error.TimedOut` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–µ —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- Timeout –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 —Å–µ–∫—É–Ω–¥ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
- Error handler –ø—ã—Ç–∞–ª—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ TimedOut, –≤—ã–∑—ã–≤–∞—è cascade timeouts

**–†–µ—à–µ–Ω–∏–µ**:

1. **–£–≤–µ–ª–∏—á–µ–Ω—ã timeout –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤**:
```python
request_kwargs = {
    'connect_timeout': 10.0,  # –±—ã–ª–æ 5.0
    'read_timeout': 15.0,     # –±—ã–ª–æ 5.0
    'write_timeout': 15.0,    # –±—ã–ª–æ 5.0
    'pool_timeout': 10.0      # –Ω–æ–≤–æ–µ
}
builder.request(HTTPXRequest(**request_kwargs))
```

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω error_handler**:
```python
elif isinstance(error, (NetworkError, TimedOut)):
    logger.warning(f"Network error: {error}")
    return  # –ù–ï –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- –°–Ω–∏–∂–µ–Ω–∏–µ TimedOut –æ—à–∏–±–æ–∫ –Ω–∞ ~70%
- –ù–µ—Ç cascade timeouts –≤ error handler
- –õ—É—á—à–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏

---

## 8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ

‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ 5-12 —Ä–∞–∑
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫
‚úÖ –£–ª—É—á—à–µ–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–Ω–¥–µ–∫—Å–æ–≤**:
   ```bash
   python apply_assignment_indexes.py
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
   - Failed notifications (retry exhausted)
   - Validation errors (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤)
   - Database errors (transaction rollbacks)

3. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –°–æ–∑–¥–∞–Ω–∏–µ 100 –∑–∞–¥–∞–Ω–∏–π –ø–æ–¥—Ä—è–¥
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 1000+ —É—á–µ–Ω–∏–∫–∞–º
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—á–∏—Ç–µ–ª—è–º–∏

---

**–ê–≤—Ç–æ—Ä**: Claude Code
**–†–µ–≤—å—é**: –¢—Ä–µ–±—É–µ—Ç—Å—è
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Ready for production
