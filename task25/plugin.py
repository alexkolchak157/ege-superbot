# plugins/task25/plugin.py

from typing import Dict, Any, Optional
import logging
import re

logger = logging.getLogger(__name__)

class Task25Plugin:
    """–ü–ª–∞–≥–∏–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏—è 25 –ï–ì–≠ –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é"""
    
    def __init__(self):
        self.name = "task25"
        self.display_name = "–ó–∞–¥–∞–Ω–∏–µ 25"
        self.description = "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –∏ –ø—Ä–∏–º–µ—Ä—ã"
        self.max_score = 6
        self.criteria = {
            "25.1": {
                "name": "–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ",
                "description": "–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ–≤–µ–¥—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è",
                "max_score": 2
            },
            "25.2": {
                "name": "–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å",
                "description": "–£–∫–∞–∑–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤", 
                "max_score": 1
            },
            "25.3": {
                "name": "–ü—Ä–∏–º–µ—Ä—ã",
                "description": "–†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º",
                "max_score": 3
            }
        }
        
    def get_info(self) -> Dict[str, Any]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞–≥–∏–Ω–µ"""
        return {
            "name": self.name,
            "display_name": self.display_name,
            "description": self.description,
            "max_score": self.max_score,
            "criteria": self.criteria
        }
    
    def create_evaluation_prompt(self, task_text: str, student_answer: str) -> str:
        """–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ YandexGPT"""
        return f"""–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ï–ì–≠ –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é. –û—Ü–µ–Ω–∏ –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ 25.

–ó–ê–î–ê–ù–ò–ï:
{task_text}

–û–¢–í–ï–¢ –£–ß–ï–ù–ò–ö–ê:
{student_answer}

–ö–†–ò–¢–ï–†–ò–ò –û–¶–ï–ù–ò–í–ê–ù–ò–Ø:

–ö—Ä–∏—Ç–µ—Ä–∏–π 25.1 - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (–º–∞–∫—Å–∏–º—É–º 2 –±–∞–ª–ª–∞):
- 2 –±–∞–ª–ª–∞: –ü—Ä–∏–≤–µ–¥–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ–≤–µ–¥—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫, –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–µ–π –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏(–∏–ª–∏) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤/–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- 1 –±–∞–ª–ª: –ü—Ä–∏–≤–µ–¥–µ–Ω–æ –≤ —Ü–µ–ª–æ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ–≤–µ–¥—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏/–∏–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏, –Ω–µ –∏—Å–∫–∞–∂–∞—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç—å –æ–±–æ—Å–Ω–æ–≤—ã–≤–∞–µ–º–æ–≥–æ —Ç–µ–∑–∏—Å–∞, –ò/–ò–õ–ò –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏(–∏–ª–∏) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤/–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- 0 –±–∞–ª–ª–æ–≤: –í—Å–µ –∏–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∏–ª–∏ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏–∏ –ò/–ò–õ–ò –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ, –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–µ –±–µ–∑ –æ–ø–æ—Ä—ã –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ–≤–µ–¥—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è, –Ω–∞ –±—ã—Ç–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ

–ö—Ä–∏—Ç–µ—Ä–∏–π 25.2 - –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å (–º–∞–∫—Å–∏–º—É–º 1 –±–∞–ª–ª):
- 1 –±–∞–ª–ª: –î–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: —É–∫–∞–∑–∞–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- 0 –±–∞–ª–ª–æ–≤: –í—Å–µ –∏–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –≤ —è–≤–Ω–æ–º –≤–∏–¥–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω–æ–≥–æ –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç

–ö—Ä–∏—Ç–µ—Ä–∏–π 25.3 - –ü—Ä–∏–º–µ—Ä—ã (–º–∞–∫—Å–∏–º—É–º 3 –±–∞–ª–ª–∞):
- 3 –±–∞–ª–ª–∞: –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (—Å–≤–µ—Ä—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ç—Ä—ë—Ö) –ø—Ä–∏–º–µ—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏/–æ—à–∏–±–∫–∏
- 2 –±–∞–ª–ª–∞: –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (—Å–≤–µ—Ä—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ç—Ä—ë—Ö) –ø—Ä–∏–º–µ—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏/–æ—à–∏–±–∫–∏
- 1 –±–∞–ª–ª: –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–≤–µ–¥—ë–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (—Å–≤–µ—Ä—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ç—Ä—ë—Ö) –ø—Ä–∏–º–µ—Ä–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏/–æ—à–∏–±–∫–∏. –ò–õ–ò –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –¥–≤–∞-—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –±–æ–ª–µ–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (—Å–≤–µ—Ä—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ç—Ä—ë—Ö), —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏/–æ—à–∏–±–∫–∏
- 0 –±–∞–ª–ª–æ–≤: –í—Å–µ –∏–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
1. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ù–ï–°–ö–û–õ–¨–ö–ò–• –†–ê–°–ü–†–û–°–¢–†–ê–ù–Å–ù–ù–´–• –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
2. –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
3. –ü—Ä–∏–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –†–ê–ó–í–Å–†–ù–£–¢–´–ú–ò (–æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è)
4. –ü—Ä–∏–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ –ø—É–Ω–∫—Ç–µ 2 –æ–±—ä–µ–∫—Ç–∞–º
5. –ö–∞—á–µ—Å—Ç–≤–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ü–µ–Ω–∫—É

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–≤–µ—Ç –∏ –≤—ã—Å—Ç–∞–≤–∏ –±–∞–ª–ª—ã —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
–ö—Ä–∏—Ç–µ—Ä–∏–π 25.1: X –±–∞–ª–ª–∞
[–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏]

–ö—Ä–∏—Ç–µ—Ä–∏–π 25.2: X –±–∞–ª–ª
[–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏]

–ö—Ä–∏—Ç–µ—Ä–∏–π 25.3: X –±–∞–ª–ª–∞
[–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏]

–ò—Ç–æ–≥–æ: X –∏–∑ 6 –±–∞–ª–ª–æ–≤"""

    def parse_evaluation_response(self, response: str) -> Dict[str, Any]:
        """–ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç –æ—Ç YandexGPT –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏"""
        try:
            scores = {}
            feedback = {}
            
            # –ü–∞—Ä—Å–∏–º –∫—Ä–∏—Ç–µ—Ä–∏–π 25.1
            pattern_25_1 = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.1:\s*(\d+)\s*–±–∞–ª–ª"
            match = re.search(pattern_25_1, response)
            if match:
                scores["25.1"] = int(match.group(1))
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–µ—Ä–∏—è 25.1 –¥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è 25.2
                feedback_pattern = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.1:.*?\n(.*?)(?=–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.2:|$)"
                feedback_match = re.search(feedback_pattern, response, re.DOTALL)
                if feedback_match:
                    feedback["25.1"] = feedback_match.group(1).strip()
            
            # –ü–∞—Ä—Å–∏–º –∫—Ä–∏—Ç–µ—Ä–∏–π 25.2
            pattern_25_2 = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.2:\s*(\d+)\s*–±–∞–ª–ª"
            match = re.search(pattern_25_2, response)
            if match:
                scores["25.2"] = int(match.group(1))
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–µ—Ä–∏—è 25.2 –¥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è 25.3
                feedback_pattern = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.2:.*?\n(.*?)(?=–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.3:|$)"
                feedback_match = re.search(feedback_pattern, response, re.DOTALL)
                if feedback_match:
                    feedback["25.2"] = feedback_match.group(1).strip()
            
            # –ü–∞—Ä—Å–∏–º –∫—Ä–∏—Ç–µ—Ä–∏–π 25.3
            pattern_25_3 = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.3:\s*(\d+)\s*–±–∞–ª–ª"
            match = re.search(pattern_25_3, response)
            if match:
                scores["25.3"] = int(match.group(1))
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–µ—Ä–∏—è 25.3 –¥–æ "–ò—Ç–æ–≥–æ"
                feedback_pattern = r"–ö—Ä–∏—Ç–µ—Ä–∏–π 25\.3:.*?\n(.*?)(?=–ò—Ç–æ–≥–æ:|$)"
                feedback_match = re.search(feedback_pattern, response, re.DOTALL)
                if feedback_match:
                    feedback["25.3"] = feedback_match.group(1).strip()
            
            # –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π –±–∞–ª–ª
            total_score = sum(scores.values())
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫
            if scores.get("25.1", 0) > 2:
                scores["25.1"] = 2
            if scores.get("25.2", 0) > 1:
                scores["25.2"] = 1  
            if scores.get("25.3", 0) > 3:
                scores["25.3"] = 3
                
            total_score = sum(scores.values())
            
            return {
                "success": True,
                "scores": scores,
                "feedback": feedback,
                "total_score": total_score,
                "max_score": self.max_score
            }
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –æ—Ç–≤–µ—Ç–∞ YandexGPT: {e}")
            logger.error(f"–û—Ç–≤–µ—Ç: {response}")
            return {
                "success": False,
                "error": str(e),
                "raw_response": response
            }
    
    def format_feedback(self, evaluation: Dict[str, Any]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if not evaluation.get("success"):
            return "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
            
        scores = evaluation.get("scores", {})
        feedback = evaluation.get("feedback", {})
        total = evaluation.get("total_score", 0)
        
        message = f"üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏—è 25**\n\n"
        
        # –ö—Ä–∏—Ç–µ—Ä–∏–π 25.1
        score_25_1 = scores.get("25.1", 0)
        message += f"**–ö—Ä–∏—Ç–µ—Ä–∏–π 25.1 (–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ):** {score_25_1}/2\n"
        if feedback.get("25.1"):
            message += f"{feedback['25.1']}\n\n"
        
        # –ö—Ä–∏—Ç–µ—Ä–∏–π 25.2
        score_25_2 = scores.get("25.2", 0)
        message += f"**–ö—Ä–∏—Ç–µ—Ä–∏–π 25.2 (–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å):** {score_25_2}/1\n"
        if feedback.get("25.2"):
            message += f"{feedback['25.2']}\n\n"
            
        # –ö—Ä–∏—Ç–µ—Ä–∏–π 25.3
        score_25_3 = scores.get("25.3", 0)
        message += f"**–ö—Ä–∏—Ç–µ—Ä–∏–π 25.3 (–ü—Ä–∏–º–µ—Ä—ã):** {score_25_3}/3\n"
        if feedback.get("25.3"):
            message += f"{feedback['25.3']}\n\n"
            
        message += f"**–ò—Ç–æ–≥–æ: {total}/{self.max_score} –±–∞–ª–ª–æ–≤**"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–ø–æ–ª–Ω–æ–º –±–∞–ª–ª–µ
        if total < self.max_score:
            message += "\n\nüí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**\n"
            
            if score_25_1 < 2:
                if score_25_1 == 0:
                    message += "‚Ä¢ –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ–≤–µ–¥—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è\n"
                else:
                    message += "‚Ä¢ –ü–æ–ª–Ω–µ–µ —Ä–∞—Å–∫—Ä–æ–π—Ç–µ –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –≤ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–∏\n"
                    
            if score_25_2 < 1:
                message += "‚Ä¢ –ß–µ—Ç–∫–æ –≤—ã–¥–µ–ª–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Ç—Ä–µ–±—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤\n"
                
            if score_25_3 < 3:
                if score_25_3 == 0:
                    message += "‚Ä¢ –ü—Ä–∏–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞\n"
                elif score_25_3 == 1:
                    message += "‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë –¥–≤–∞ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞\n"
                else:
                    message += "‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –µ—â—ë –æ–¥–∏–Ω —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –ø—Ä–∏–º–µ—Ä\n"
        
        return message

def setup() -> Task25Plugin:
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞"""
    return Task25Plugin()